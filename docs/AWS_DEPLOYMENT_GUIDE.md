# AWS ì±„ì  ì„œë²„ ë°°í¬ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” CodeBrainerì˜ ì±„ì  ì„œë²„ë¥¼ AWSì— ë°°í¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì •ë³´ì™€ ì„¤ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [í˜„ì¬ ì¸í”„ë¼ êµ¬ì¡° ë¶„ì„](#í˜„ì¬-ì¸í”„ë¼-êµ¬ì¡°-ë¶„ì„)
2. [í•„ìš”í•œ AWS ì„œë¹„ìŠ¤ ë° ë¦¬ì†ŒìŠ¤](#í•„ìš”í•œ-aws-ì„œë¹„ìŠ¤-ë°-ë¦¬ì†ŒìŠ¤)
3. [ë³´ì•ˆ ì„¤ì •](#ë³´ì•ˆ-ì„¤ì •)
4. [ë„¤íŠ¸ì›Œí¬ êµ¬ì„±](#ë„¤íŠ¸ì›Œí¬-êµ¬ì„±)
5. [í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì •](#í™˜ê²½-ë³€ìˆ˜-ë°-ì„¤ì •)
6. [ë°°í¬ ì•„í‚¤í…ì²˜ ì˜µì…˜](#ë°°í¬-ì•„í‚¤í…ì²˜-ì˜µì…˜)
7. [ë¹„ìš© ì¶”ì •](#ë¹„ìš©-ì¶”ì •)
8. [í•„ìˆ˜ ì •ë³´ ì²´í¬ë¦¬ìŠ¤íŠ¸](#í•„ìˆ˜-ì •ë³´-ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## í˜„ì¬ ì¸í”„ë¼ êµ¬ì¡° ë¶„ì„

### í˜„ì¬ êµ¬ì„± ìš”ì†Œ

| ì„œë¹„ìŠ¤ | í¬íŠ¸ | ì—­í•  | Docker ì´ë¯¸ì§€/ê¸°ìˆ  |
|--------|------|------|-------------------|
| **Orchestrator** | 8080 | Spring Boot API ì„œë²„ | Custom Dockerfile |
| **Judge0 Server** | 2358 | ì±„ì  API ì„œë²„ | judge0/judge0:1.13.1 |
| **Judge0 Worker** | - | ì±„ì  ì›Œì»¤ | judge0/judge0:1.13.1 |
| **PostgreSQL** | 5432 | ë°ì´í„°ë² ì´ìŠ¤ | postgres:16 |
| **Redis** | 6379 | ì‘ì—… í | redis:7-alpine |
| **RabbitMQ** | 5672, 15672 | ë©”ì‹œì§€ í | rabbitmq:3-management |

### Judge0 íŠ¹ìˆ˜ ìš”êµ¬ì‚¬í•­

âš ï¸ **ì¤‘ìš”**: Judge0ëŠ” `privileged: true` ëª¨ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ë¦¬ì†ŒìŠ¤ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

- **ë³´ì•ˆ ìœ„í—˜**: privileged ëª¨ë“œëŠ” ë³´ì•ˆìƒ ìœ„í—˜í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©
- **ECS/Fargate ì œí•œ**: AWS FargateëŠ” privileged ëª¨ë“œë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
- **ê¶Œì¥**: EC2 ê¸°ë°˜ ECS ë˜ëŠ” ë…ë¦½ EC2 ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©

---

## í•„ìš”í•œ AWS ì„œë¹„ìŠ¤ ë° ë¦¬ì†ŒìŠ¤

### 1. ì»´í“¨íŒ… (Compute)

#### ì˜µì…˜ A: EC2 + Docker (ê¶Œì¥)

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **EC2 ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: `t3.large` ì´ìƒ (Judge0 Workerê°€ CPU ì§‘ì•½ì )
  - ìµœì†Œ: 2 vCPU, 8GB RAM
  - ê¶Œì¥: 4 vCPU, 16GB RAM (ë™ì‹œ ì±„ì  ì²˜ë¦¬)
- **ìš´ì˜ì²´ì œ**: Amazon Linux 2023 ë˜ëŠ” Ubuntu 22.04 LTS
- **Docker**: Docker Engine ì„¤ì¹˜ í•„ìš”
- **ìŠ¤í† ë¦¬ì§€**: 
  - ë£¨íŠ¸ ë³¼ë¥¨: 30GB (gp3)
  - ì¶”ê°€ EBS ë³¼ë¥¨: 100GB (ì½”ë“œ ì €ì¥ìš©, gp3)

**ë¹„ìš©**: ì•½ $70-150/ì›” (ì˜ˆì•½ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© ì‹œ ì ˆê° ê°€ëŠ¥)

#### ì˜µì…˜ B: ECS on EC2

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ECS í´ëŸ¬ìŠ¤í„°**: EC2 ê¸°ë°˜ (FargateëŠ” privileged ë¯¸ì§€ì›)
- **EC2 ì¸ìŠ¤í„´ìŠ¤**: ì˜µì…˜ Aì™€ ë™ì¼
- **ECS Task Definition**: Judge0 Server, Worker ì •ì˜

**ë¹„ìš©**: ì˜µì…˜ A + ECS ì„œë¹„ìŠ¤ ë¹„ìš© ($0.10/ì‹œê°„/í´ëŸ¬ìŠ¤í„°)

#### ì˜µì…˜ C: EKS (Kubernetes)

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **EKS í´ëŸ¬ìŠ¤í„°**: Managed Kubernetes
- **Node Group**: EC2 ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹
- **ë„¤ì„ìŠ¤í˜ì´ìŠ¤**: Judge0 ì „ìš© ë„¤ì„ìŠ¤í˜ì´ìŠ¤

**ë¹„ìš©**: í´ëŸ¬ìŠ¤í„° $0.10/ì‹œê°„ + ë…¸ë“œ ë¹„ìš© (ì•½ $200-300/ì›”)

**ê¶Œì¥**: ì˜µì…˜ A (EC2 + Docker) - ê°€ì¥ ê°„ë‹¨í•˜ê³  ë¹„ìš© íš¨ìœ¨ì 

---

### 2. ë°ì´í„°ë² ì´ìŠ¤

#### PostgreSQL

**ì˜µì…˜ A: RDS PostgreSQL (ê¶Œì¥)**

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: `db.t3.medium` ì´ìƒ
  - ìµœì†Œ: 2 vCPU, 4GB RAM
  - ê¶Œì¥: 2 vCPU, 8GB RAM
- **ì—”ì§„ ë²„ì „**: PostgreSQL 16
- **ìŠ¤í† ë¦¬ì§€**: 
  - ìµœì†Œ: 20GB (gp3)
  - ê¶Œì¥: 100GB (ìë™ í™•ì¥ í™œì„±í™”)
- **Multi-AZ**: í”„ë¡œë•ì…˜ ê¶Œì¥ (ì¬í•´ ë³µêµ¬)
- **ë°±ì—…**: ìë™ ë°±ì—… í™œì„±í™” (7ì¼ ë³´ê´€)

**ë¹„ìš©**: ì•½ $50-150/ì›” (Multi-AZ ì‹œ 2ë°°)

**ì˜µì…˜ B: EC2ì— ì§ì ‘ ì„¤ì¹˜**

- EC2 ì¸ìŠ¤í„´ìŠ¤ì— PostgreSQL ì§ì ‘ ì„¤ì¹˜
- ìë™ ë°±ì—… ë° ë³µêµ¬ ì§ì ‘ ê´€ë¦¬ í•„ìš”
- ë¹„ìš©: EC2 ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ (ì•½ $70/ì›”)

**ê¶Œì¥**: ì˜µì…˜ A (RDS) - ê´€ë¦¬ í¸ì˜ì„±ê³¼ ì•ˆì •ì„±

#### Redis

**ì˜µì…˜ A: ElastiCache for Redis (ê¶Œì¥)**

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ë…¸ë“œ íƒ€ì…**: `cache.t3.medium` ì´ìƒ
  - ìµœì†Œ: 2 vCPU, 3.09GB RAM
  - ê¶Œì¥: 2 vCPU, 6.05GB RAM
- **ì—”ì§„ ë²„ì „**: Redis 7.x
- **Multi-AZ**: ê³ ê°€ìš©ì„± (ì„ íƒì‚¬í•­)

**ë¹„ìš©**: ì•½ $30-80/ì›”

**ì˜µì…˜ B: EC2ì— ì§ì ‘ ì„¤ì¹˜**

- EC2 ì¸ìŠ¤í„´ìŠ¤ì— Redis ì§ì ‘ ì„¤ì¹˜
- ë¹„ìš©: EC2 ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ

**ê¶Œì¥**: ì˜µì…˜ A (ElastiCache) - ê´€ë¦¬ í¸ì˜ì„±

---

### 3. ë©”ì‹œì§€ í

#### RabbitMQ

**ì˜µì…˜ A: Amazon MQ (Managed RabbitMQ)**

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: `mq.t3.micro` (ê°œë°œ/í…ŒìŠ¤íŠ¸) ë˜ëŠ” `mq.m5.large` (í”„ë¡œë•ì…˜)
- **ì—”ì§„**: RabbitMQ 3.11.x
- **Multi-AZ**: í”„ë¡œë•ì…˜ ê¶Œì¥

**ë¹„ìš©**: ì•½ $50-200/ì›”

**ì˜µì…˜ B: EC2ì— ì§ì ‘ ì„¤ì¹˜**

- EC2 ì¸ìŠ¤í„´ìŠ¤ì— RabbitMQ ì§ì ‘ ì„¤ì¹˜
- ë¹„ìš©: EC2 ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ

**ê¶Œì¥**: ì˜µì…˜ B (EC2 ì§ì ‘ ì„¤ì¹˜) - ë¹„ìš© íš¨ìœ¨ì , Judge0 ì„œë²„ì™€ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© ê°€ëŠ¥

---

### 4. ìŠ¤í† ë¦¬ì§€

#### ì½”ë“œ ì €ì¥ì†Œ

**ì˜µì…˜ A: S3 (ê¶Œì¥)**

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ë²„í‚·**: `codebrainer-submissions` (ì œì¶œ ì½”ë“œ)
- **ë²„í‚·**: `codebrainer-problems` (ë¬¸ì œ íŒŒì¼)
- **ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤**: Standard ë˜ëŠ” Standard-IA
- **ë¼ì´í”„ì‚¬ì´í´ ì •ì±…**: 30ì¼ í›„ Standard-IAë¡œ ì´ë™, 90ì¼ í›„ Glacierë¡œ ì´ë™

**ë¹„ìš©**: 
- ì €ì¥: $0.023/GB/ì›”
- ìš”ì²­: $0.005/1,000 PUT ìš”ì²­

**ì˜µì…˜ B: EBS ë³¼ë¥¨**

- EC2 ì¸ìŠ¤í„´ìŠ¤ì— EBS ë³¼ë¥¨ ë§ˆìš´íŠ¸
- ë¹„ìš©: $0.10/GB/ì›” (gp3)

**ê¶Œì¥**: ì˜µì…˜ A (S3) - í™•ì¥ì„±ê³¼ ë¹„ìš© íš¨ìœ¨ì„±

---

### 5. ë„¤íŠ¸ì›Œí¬

#### VPC êµ¬ì„±

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **VPC**: 1ê°œ (CIDR: 10.0.0.0/16 ê¶Œì¥)
- **Public Subnet**: 2ê°œ (ë‹¤ë¥¸ ê°€ìš© ì˜ì—­)
  - Internet Gateway ì—°ê²°
  - Orchestrator, Judge0 Server ë°°ì¹˜
- **Private Subnet**: 2ê°œ (ë‹¤ë¥¸ ê°€ìš© ì˜ì—­)
  - NAT Gateway ì—°ê²°
  - RDS, ElastiCache, RabbitMQ ë°°ì¹˜
- **Route Tables**: Public/Private ë¶„ë¦¬
- **Security Groups**: ì„œë¹„ìŠ¤ë³„ ë¶„ë¦¬

**ë¹„ìš©**: 
- NAT Gateway: $0.045/ì‹œê°„ (ì•½ $32/ì›”)
- ë°ì´í„° ì „ì†¡: $0.01/GB

---

### 6. ë¡œë“œ ë°¸ëŸ°ì„œ

#### Application Load Balancer (ALB)

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **ALB**: Orchestrator APIìš©
- **Target Group**: Orchestrator ì„œë²„ ê·¸ë£¹
- **ë¦¬ìŠ¤ë„ˆ**: HTTPS (443), HTTP (80) â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
- **SSL ì¸ì¦ì„œ**: ACM (AWS Certificate Manager) ì‚¬ìš©

**ë¹„ìš©**: ì•½ $16/ì›” + ë°ì´í„° ì „ì†¡ ë¹„ìš©

---

### 7. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

#### CloudWatch

**í•„ìš”í•œ ë¦¬ì†ŒìŠ¤:**
- **CloudWatch Logs**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ìˆ˜ì§‘
- **CloudWatch Metrics**: CPU, ë©”ëª¨ë¦¬, ë„¤íŠ¸ì›Œí¬ ëª¨ë‹ˆí„°ë§
- **CloudWatch Alarms**: ì´ìƒ ì§•í›„ ì•Œë¦¼

**ë¹„ìš©**: 
- ë¡œê·¸ ìˆ˜ì§‘: $0.50/GB
- ë©”íŠ¸ë¦­: $0.30/ë©”íŠ¸ë¦­/ì›”

---

## ë³´ì•ˆ ì„¤ì •

### 1. Security Groups

#### Judge0 Server Security Group

```yaml
Inbound Rules:
  - Type: Custom TCP
    Port: 2358
    Source: Orchestrator Security Group
    Description: Judge0 API ì ‘ê·¼

Outbound Rules:
  - All traffic í—ˆìš© (ì™¸ë¶€ ì¸í„°ë„· ì ‘ê·¼ í•„ìš” ì—†ìŒ)
```

#### Orchestrator Security Group

```yaml
Inbound Rules:
  - Type: HTTPS
    Port: 443
    Source: 0.0.0.0/0
    Description: Public API ì ‘ê·¼
  - Type: HTTP
    Port: 80
    Source: 0.0.0.0/0
    Description: HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸
  - Type: Custom TCP
    Port: 8080
    Source: ALB Security Group
    Description: ALB â†’ Orchestrator

Outbound Rules:
  - Type: Custom TCP
    Port: 2358
    Destination: Judge0 Security Group
    Description: Judge0 API í˜¸ì¶œ
  - Type: PostgreSQL
    Port: 5432
    Destination: RDS Security Group
  - Type: Custom TCP
    Port: 6379
    Destination: ElastiCache Security Group
  - Type: Custom TCP
    Port: 5672
    Destination: RabbitMQ Security Group
```

#### RDS Security Group

```yaml
Inbound Rules:
  - Type: PostgreSQL
    Port: 5432
    Source: Orchestrator Security Group
    Description: Orchestrator DB ì ‘ê·¼
  - Type: PostgreSQL
    Port: 5432
    Source: Judge0 Security Group
    Description: Judge0 DB ì ‘ê·¼

Outbound Rules:
  - ì—†ìŒ (í•„ìš” ì—†ìŒ)
```

#### ElastiCache Security Group

```yaml
Inbound Rules:
  - Type: Custom TCP
    Port: 6379
    Source: Judge0 Security Group
    Description: Judge0 Redis ì ‘ê·¼

Outbound Rules:
  - ì—†ìŒ
```

---

### 2. IAM ì—­í•  ë° ì •ì±…

#### EC2 ì¸ìŠ¤í„´ìŠ¤ ì—­í•  (Judge0 ì„œë²„)

**í•„ìš”í•œ ê¶Œí•œ:**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": [
        "arn:aws:s3:::codebrainer-submissions/*",
        "arn:aws:s3:::codebrainer-problems/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "cloudwatch:PutMetricData",
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "*"
    }
  ]
}
```

#### EC2 ì¸ìŠ¤í„´ìŠ¤ ì—­í•  (Orchestrator)

**í•„ìš”í•œ ê¶Œí•œ:**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject"
      ],
      "Resource": [
        "arn:aws:s3:::codebrainer-submissions/*",
        "arn:aws:s3:::codebrainer-problems/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue"
      ],
      "Resource": [
        "arn:aws:secretsmanager:*:*:secret:codebrainer/db/*",
        "arn:aws:secretsmanager:*:*:secret:codebrainer/judge0/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "cloudwatch:PutMetricData",
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "*"
    }
  ]
}
```

---

## ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

### VPC ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VPC (10.0.0.0/16)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Public Subnet  â”‚         â”‚  Public Subnet  â”‚           â”‚
â”‚  â”‚   (10.0.1.0/24) â”‚         â”‚   (10.0.2.0/24) â”‚           â”‚
â”‚  â”‚   AZ: us-east-1aâ”‚         â”‚   AZ: us-east-1bâ”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ â€¢ ALB           â”‚         â”‚ â€¢ (Reserved)    â”‚           â”‚
â”‚  â”‚ â€¢ Orchestrator  â”‚         â”‚                 â”‚           â”‚
â”‚  â”‚ â€¢ Judge0 Server â”‚         â”‚                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                             â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                       â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚ Internet Gatewayâ”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Private Subnet  â”‚         â”‚ Private Subnet  â”‚           â”‚
â”‚  â”‚  (10.0.10.0/24) â”‚         â”‚  (10.0.20.0/24) â”‚           â”‚
â”‚  â”‚   AZ: us-east-1aâ”‚         â”‚   AZ: us-east-1bâ”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ â€¢ RDS (Primary) â”‚         â”‚ â€¢ RDS (Standby) â”‚           â”‚
â”‚  â”‚ â€¢ ElastiCache   â”‚         â”‚ â€¢ RabbitMQ      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                             â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                       â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚   NAT Gateway   â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì •

### Judge0 Server í™˜ê²½ ë³€ìˆ˜

```bash
# Redis ì„¤ì •
REDIS_HOST=<ElastiCache ì—”ë“œí¬ì¸íŠ¸>
REDIS_PORT=6379

# PostgreSQL ì„¤ì •
POSTGRES_HOST=<RDS ì—”ë“œí¬ì¸íŠ¸>
POSTGRES_PORT=5432
POSTGRES_DB=judge0
POSTGRES_USER=judge0
POSTGRES_PASSWORD=<AWS Secrets Managerì—ì„œ ê°€ì ¸ì˜¤ê¸°>

# Judge0 ì„¤ì •
RAILS_ENV=production
JUDGE0_MAX_EXECUTION_TIME=15
JUDGE0_MAX_OUTPUT_LENGTH=8192
JUDGE0_MAX_QUEUE_SIZE=1000
JUDGE0_MAX_CPU_TIME_LIMIT=15
JUDGE0_MAX_WALL_TIME_LIMIT=30
JUDGE0_MAX_MEMORY_LIMIT=512000
JUDGE0_MAX_PROCESSES_AND_OR_THREADS=120
JUDGE0_MAX_FILE_SIZE=1024

# ë³´ì•ˆ
JUDGE0_DISABLE_SSL_VERIFICATION=false
```

### Orchestrator í™˜ê²½ ë³€ìˆ˜

```bash
# Spring ì„¤ì •
SPRING_PROFILES_ACTIVE=production
SPRING_DATASOURCE_URL=jdbc:postgresql://<RDS ì—”ë“œí¬ì¸íŠ¸>:5432/codebrainer
SPRING_DATASOURCE_USERNAME=codebrainer
SPRING_DATASOURCE_PASSWORD=<AWS Secrets Managerì—ì„œ ê°€ì ¸ì˜¤ê¸°>

# Judge0 ì„¤ì •
JUDGE0_API_URL=http://<Judge0 ì„œë²„ Private IP>:2358
JUDGE0_CALLBACK_URL=https://api.codebrainer.com/internal/judge0/callback
JUDGE0_CALLBACK_ENABLED=false

# RabbitMQ ì„¤ì •
RABBITMQ_HOST=<RabbitMQ Private IP>
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=<ìƒì„±í•œ ì‚¬ìš©ì>
RABBITMQ_PASSWORD=<AWS Secrets Managerì—ì„œ ê°€ì ¸ì˜¤ê¸°>

# ìŠ¤í† ë¦¬ì§€ ì„¤ì •
STORAGE_BASE_PATH=/data/storage
# ë˜ëŠ” S3 ì‚¬ìš© ì‹œ
STORAGE_TYPE=s3
AWS_S3_BUCKET=codebrainer-submissions
AWS_REGION=us-east-1
```

---

## ë°°í¬ ì•„í‚¤í…ì²˜ ì˜µì…˜

### ì˜µì…˜ 1: ë‹¨ì¼ EC2 ì¸ìŠ¤í„´ìŠ¤ (ê°œë°œ/í…ŒìŠ¤íŠ¸)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EC2 Instance (t3.large)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Docker Compose             â”‚ â”‚
â”‚  â”‚  â€¢ Orchestrator             â”‚ â”‚
â”‚  â”‚  â€¢ Judge0 Server            â”‚ â”‚
â”‚  â”‚  â€¢ Judge0 Worker            â”‚ â”‚
â”‚  â”‚  â€¢ RabbitMQ                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â–¶ RDS PostgreSQL
         â”œâ”€â”€â–¶ ElastiCache Redis
         â””â”€â”€â–¶ S3 (ì½”ë“œ ì €ì¥)
```

**ì¥ì **: ê°„ë‹¨, ë¹„ìš© íš¨ìœ¨ì   
**ë‹¨ì **: ë‹¨ì¼ ì¥ì• ì , í™•ì¥ì„± ì œí•œ

---

### ì˜µì…˜ 2: ë¶„ë¦¬ëœ ì„œë¹„ìŠ¤ (í”„ë¡œë•ì…˜ ê¶Œì¥)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ALB (Application Load Balancer)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Orchestratorâ”‚    â”‚Orchestratorâ”‚    â”‚Orchestratorâ”‚
â”‚  EC2 #1  â”‚    â”‚  EC2 #2  â”‚    â”‚  EC2 #3  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Judge0   â”‚      â”‚Judge0   â”‚      â”‚Judge0   â”‚
â”‚Server   â”‚      â”‚Worker   â”‚      â”‚Worker   â”‚
â”‚EC2 #1   â”‚      â”‚EC2 #2   â”‚      â”‚EC2 #3   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚  RDS   â”‚      â”‚ElastiCacheâ”‚    â”‚ RabbitMQâ”‚
â”‚PostgreSQLâ”‚    â”‚  Redis   â”‚    â”‚   EC2    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¥ì **: ê³ ê°€ìš©ì„±, í™•ì¥ì„±, ì¥ì•  ê²©ë¦¬  
**ë‹¨ì **: ë³µì¡ë„ ì¦ê°€, ë¹„ìš© ì¦ê°€

---

## ë¹„ìš© ì¶”ì •

### ì›”ë³„ ì˜ˆìƒ ë¹„ìš© (í”„ë¡œë•ì…˜, us-east-1 ê¸°ì¤€)

| ì„œë¹„ìŠ¤ | ë¦¬ì†ŒìŠ¤ | ë¹„ìš© |
|--------|--------|------|
| **EC2** | t3.large x 3 (Orchestrator) | $150 |
| **EC2** | t3.large x 3 (Judge0) | $150 |
| **RDS PostgreSQL** | db.t3.medium (Multi-AZ) | $150 |
| **ElastiCache Redis** | cache.t3.medium | $50 |
| **RabbitMQ** | EC2 t3.small | $15 |
| **ALB** | Application Load Balancer | $16 |
| **NAT Gateway** | NAT Gateway x 2 | $64 |
| **S3** | 100GB ì €ì¥ + ìš”ì²­ | $5 |
| **ë°ì´í„° ì „ì†¡** | 500GB/ì›” | $45 |
| **CloudWatch** | ë¡œê·¸ + ë©”íŠ¸ë¦­ | $20 |
| **ì´ê³„** | | **ì•½ $665/ì›”** |

**ë¹„ìš© ì ˆê° ë°©ë²•:**
- ì˜ˆì•½ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©: 30-40% ì ˆê°
- NAT Gateway ìµœì í™”: ë‹¨ì¼ NAT Gateway ì‚¬ìš©
- ìŠ¤íŒŸ ì¸ìŠ¤í„´ìŠ¤: Judge0 Workerì— ì‚¬ìš© (70% ì ˆê°, ë‹¨ ì•ˆì •ì„± ì €í•˜)

---

## í•„ìˆ˜ ì •ë³´ ì²´í¬ë¦¬ìŠ¤íŠ¸

### AWS ê³„ì • ë° ê¶Œí•œ

- [ ] AWS ê³„ì • ìƒì„± ì™„ë£Œ
- [ ] ê´€ë¦¬ì ê¶Œí•œ ë˜ëŠ” í•„ìš”í•œ IAM ê¶Œí•œ ë³´ìœ 
- [ ] ê²°ì œ ì •ë³´ ë“±ë¡ ì™„ë£Œ
- [ ] MFA (Multi-Factor Authentication) í™œì„±í™”

### ë„¤íŠ¸ì›Œí¬ ì„¤ì •

- [ ] VPC ìƒì„± (CIDR: 10.0.0.0/16)
- [ ] Public Subnet 2ê°œ ìƒì„± (ë‹¤ë¥¸ ê°€ìš© ì˜ì—­)
- [ ] Private Subnet 2ê°œ ìƒì„± (ë‹¤ë¥¸ ê°€ìš© ì˜ì—­)
- [ ] Internet Gateway ìƒì„± ë° ì—°ê²°
- [ ] NAT Gateway ìƒì„± (Private Subnetìš©)
- [ ] Route Tables ì„¤ì • ì™„ë£Œ
- [ ] Security Groups ìƒì„± ë° ê·œì¹™ ì„¤ì •

### ë°ì´í„°ë² ì´ìŠ¤

- [ ] RDS PostgreSQL ì„œë¸Œë„· ê·¸ë£¹ ìƒì„±
- [ ] RDS PostgreSQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  - [ ] ì—”ë“œí¬ì¸íŠ¸ ì£¼ì†Œ í™•ì¸
  - [ ] ë§ˆìŠ¤í„° ì‚¬ìš©ìëª…/ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
  - [ ] Security Group ì—°ê²°
- [ ] ElastiCache ì„œë¸Œë„· ê·¸ë£¹ ìƒì„±
- [ ] ElastiCache Redis í´ëŸ¬ìŠ¤í„° ìƒì„±
  - [ ] ì—”ë“œí¬ì¸íŠ¸ ì£¼ì†Œ í™•ì¸
  - [ ] Security Group ì—°ê²°

### ìŠ¤í† ë¦¬ì§€

- [ ] S3 ë²„í‚· ìƒì„± (`codebrainer-submissions`)
- [ ] S3 ë²„í‚· ìƒì„± (`codebrainer-problems`)
- [ ] ë²„í‚· ì •ì±… ì„¤ì •
- [ ] CORS ì„¤ì • (í•„ìš”ì‹œ)

### ë³´ì•ˆ

- [ ] AWS Secrets Manager ì‹œí¬ë¦¿ ìƒì„±
  - [ ] RDS ë¹„ë°€ë²ˆí˜¸
  - [ ] Judge0 ë¹„ë°€ë²ˆí˜¸
  - [ ] RabbitMQ ë¹„ë°€ë²ˆí˜¸
- [ ] IAM ì—­í•  ìƒì„±
  - [ ] EC2 ì¸ìŠ¤í„´ìŠ¤ ì—­í•  (Judge0)
  - [ ] EC2 ì¸ìŠ¤í„´ìŠ¤ ì—­í•  (Orchestrator)
- [ ] IAM ì •ì±… ìƒì„± ë° ì—°ê²°
- [ ] Security Groups ê·œì¹™ ê²€í† 

### SSL/TLS

- [ ] ACMì—ì„œ SSL ì¸ì¦ì„œ ìš”ì²­
- [ ] ë„ë©”ì¸ ê²€ì¦ ì™„ë£Œ
- [ ] ALBì— ì¸ì¦ì„œ ì—°ê²°

### ëª¨ë‹ˆí„°ë§

- [ ] CloudWatch Log Groups ìƒì„±
- [ ] CloudWatch Alarms ì„¤ì •
- [ ] SNS í† í”½ ìƒì„± (ì•Œë¦¼ìš©)

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬

- [ ] EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
  - [ ] Orchestrator ì„œë²„
  - [ ] Judge0 ì„œë²„
  - [ ] Judge0 Worker (í•„ìš”ì‹œ)
- [ ] Docker ì„¤ì¹˜ ì™„ë£Œ
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] Docker Compose íŒŒì¼ ë°°í¬
- [ ] ì„œë¹„ìŠ¤ ì‹œì‘ ë° í—¬ìŠ¤ ì²´í¬

---

## ë‹¤ìŒ ë‹¨ê³„

1. **VPC ë° ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
   - AWS Consoleì—ì„œ VPC ìƒì„±
   - ì„œë¸Œë„·, ë¼ìš°íŒ… í…Œì´ë¸” ì„¤ì •

2. **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •**
   - RDS PostgreSQL ìƒì„±
   - ElastiCache Redis ìƒì„±

3. **EC2 ì¸ìŠ¤í„´ìŠ¤ ë°°í¬**
   - Judge0 ì„œë²„ ë°°í¬
   - Orchestrator ì„œë²„ ë°°í¬

4. **ì—°ê²° í…ŒìŠ¤íŠ¸**
   - ê° ì„œë¹„ìŠ¤ ê°„ ì—°ê²° í™•ì¸
   - í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

5. **ëª¨ë‹ˆí„°ë§ ì„¤ì •**
   - CloudWatch ëŒ€ì‹œë³´ë“œ ìƒì„±
   - ì•ŒëŒ ì„¤ì •

---

## ì°¸ê³  ìë£Œ

- [Judge0 ê³µì‹ ë¬¸ì„œ](https://github.com/judge0/judge0)
- [AWS Well-Architected Framework](https://aws.amazon.com/architecture/well-architected/)
- [AWS ECS Best Practices](https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/intro.html)
- [RDS PostgreSQL ê°€ì´ë“œ](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_GettingStarted.CreatingConnecting.PostgreSQL.html)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„ 1ì›”

